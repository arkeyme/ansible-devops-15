---
- name: install apache httpd
  hosts: [ node1.example.com, node2.example.com ]
  vars:
      anonymous_enable: yes
      local_enable: yes
      write_enable: yes
      anon_upload_enable: yes
      vsftp_root: /var/ftp/pub
      service_name: vsftpd

  tasks:
  - name: Install vsftpd
    yum:
      name: vsftpd
      state: latest

  - name: use template to copy FTP config
    template:
      src: vsftpd.j2
      dest: /etc/vsftpd/vsftpd.conf
    notify: restart service

  - name: Recursively change ownership of a directory
    file:
      path: "{{ vsftp_root }}"
      state: directory
      recurse: yes
      owner: ftp
      mode: '0755'
    notify: restart service

  - name: Start service vsftpd, if not started
    service:
      name: "{{ service_name }}"
      state: started
      enabled: yes

  - name: Check if ftpd_anon_write exists
    shell: getsebool -a | grep '^ftpd_anon_write\b'
    register: var_exists
    failed_when: false
    changed_when: false

  - name: Allow access to anon directories
    seboolean:
      name: ftpd_anon_write
      state: yes
      persistent: yes
    when: var_exists.rc == 0

  handlers:
  - name: restart service
    service:
      name: "{{ service_name }}"
      state: restarted

